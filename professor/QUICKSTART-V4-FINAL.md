# 🎯 Phase 4 v4 - 최종 테스트 가이드

## 📥 다운로드

[**phase4-feedback-v4-coordinate-fix.zip (117 KB)**](computer:///mnt/user-data/outputs/phase4-feedback-v4-coordinate-fix.zip)

---

## 🔥 수정 완료!

1. ✅ 스코프 오류 해결 (`redrawMarkersForPage is not defined`)
2. ✅ 좌표 계산 수정 (엉뚱한 위치 → 정확한 위치)
3. ✅ 스케일 변환 적용 (100%, 150%, 75% 모두 지원)

---

## ⚡ 3분 최종 테스트

### **1단계: F12 콘솔 열기 (필수!)**
```
1. index.html 열기
2. F12 누르기
3. Console 탭 선택
```

### **2단계: 100% 기본 테스트 (1분)**
```
1. [제출물 피드백] → 아무 제출물 클릭
2. [선택] 도구 클릭
3. PDF 텍스트 드래그

✅ 콘솔 확인:
"텍스트 선택 시작: { currentScale: 1 }"
"Rect 0: { 픽셀: {...}, 논리: {...} }"
"✅ Added annotation: ..."
"🔍 마커 재생성 시작: { currentScale: 1 }"
"✅ Marker 1 생성: ..."

✅ 화면 확인:
- 빨간 사각형이 선택한 텍스트 위에 정확히 표시
- 마커(①)가 텍스트 좌상단에 표시
- 토스트 "텍스트 영역이 선택되었습니다"
```

### **3단계: 확대 테스트 (1분)**
```
1. 확대 버튼 클릭 (또는 Ctrl + +)
2. [선택] 도구로 다른 텍스트 드래그

✅ 콘솔 확인:
"currentScale: 1.5" (또는 다른 값)

✅ 화면 확인:
- 빨간 사각형이 여전히 정확한 위치
- 마커가 올바른 위치
```

### **4단계: 영역 지정 테스트 (30초)**
```
1. [영역지정] 도구 클릭
2. 드래그로 영역 지정

✅ 콘솔 확인:
"영역 지정 완료: ..."
"✅ Added annotation: ..."

✅ 화면 확인:
- 사각형이 드래그한 영역에 정확히
- 마커 즉시 표시
```

### **5단계: 연결 기능 (30초)**
```
1. 코멘트 ① [연결] 클릭
2. 코멘트 ② [연결] 클릭
3. 코멘트 ① 카드에서 "💬 2" 클릭

✅ 화면 확인:
- 2번 페이지로 이동
- 2번 코멘트 하이라이트
- 2번 카드로 스크롤
```

---

## 🧪 체크리스트

### **필수 확인**
- [ ] F12 콘솔 열림
- [ ] 텍스트 드래그 → 정확한 위치
- [ ] 확대(150%) → 텍스트 드래그 → 정확한 위치
- [ ] 축소(75%) → 텍스트 드래그 → 정확한 위치
- [ ] 영역 지정 → 정확한 위치
- [ ] 마커 즉시 표시
- [ ] 연결 코멘트 이동

### **오류 확인**
- [ ] 콘솔에 "❌" 없음
- [ ] "is not defined" 오류 없음
- [ ] 빨간 사각형이 엉뚱한 곳 안 나타남

---

## 📊 예상 로그

### **정상 작동 시 (Scale = 1.5)**
```
텍스트 선택 시작: {clientRects: 2, currentScale: 1.5}
Rect 0: {
  픽셀: {left: 300, top: 450},
  논리: {left: 200, top: 300, width: 280, height: 16}
}
✅ Added annotation: type=comment, page=1
🔍 마커 재생성 시작: {page: 1, currentScale: 1.5}
  Comment 1: {
    논리: {left: 200, top: 300},
    픽셀: {left: 300, top: 450}
  }
    ✅ Marker 1 생성: {left: 300, top: 450}
✅ 마커 재생성 완료: {total: 1}
```

---

## 🎯 핵심 개념

| Scale | 텍스트 선택 | 마커 표시 |
|-------|------------|----------|
| **100%** | 200px → 200 | 200 → 200px |
| **150%** | 300px → 200 | 200 → 300px |
| **75%** | 150px → 200 | 200 → 150px |

**핵심:**
- 저장된 좌표는 항상 논리 좌표 (200)
- 화면 표시는 스케일에 따라 변함
- 좌표 변환이 자동으로 이루어짐

---

## 💡 문제 해결

### **여전히 엉뚱한 위치에 표시되면**
```
1. F12 콘솔에서 currentScale 확인
2. "픽셀" → "논리" 변환 로그 확인
3. 변환 공식: 논리 = 픽셀 / currentScale
```

### **마커가 안 보이면**
```
1. "마커 재생성 시작" 로그 확인
2. "Marker N 생성" 로그 확인
3. 변환 공식: 픽셀 = 논리 × currentScale
```

---

## 🎉 수정 요약

### **v3 → v4**
```
1. redrawMarkersForPage 스코프 오류 ✅
2. 좌표 계산 오류 ✅
3. 스케일 변환 누락 ✅
```

### **Before**
```
텍스트 드래그 → 엉뚱한 위치 😱
확대/축소 → 더 이상해짐 😱😱
```

### **After**
```
텍스트 드래그 → 정확한 위치 ✅
확대/축소 → 여전히 정확 ✅
모든 스케일에서 작동 ✅
```

---

## 📚 README 참고

- **QUICKSTART-V4.md** - 이 파일 (빠른 테스트)
- **README-COORDINATE-FIX.md** - 좌표 계산 상세 설명
- **README-SCOPE-FIX.md** - 스코프 오류 수정
- **README-PHASE4-V4-DEBUG.md** - 디버깅 가이드

---

**모든 확대/축소 비율에서 정확하게 작동합니다!** 🎉

**테스트 후 결과를 알려주세요!** 🔍
