# 🧪 Phase 4 v4 - 디버그 테스트 가이드

## 📥 다운로드

[**phase4-feedback-v4-debug.zip (111 KB)**](computer:///mnt/user-data/outputs/phase4-feedback-v4-debug.zip)

---

## 🎯 이번 v4의 핵심

**원인 파악 완료 + 근본 해결 + 디버깅 로그**

1. ✅ 텍스트 선택 좌표 계산 근본 수정
2. ✅ 마커 즉시 생성 (setTimeout 제거)
3. ✅ 모든 도구에서 renderAll() 호출
4. ✅ 상세한 콘솔 로그 추가
5. ✅ 연결된 코멘트 이동 기능

---

## ⚡ 3분 테스트

### **1단계: F12 콘솔 열기 (필수!)**
```
1. 브라우저에서 index.html 열기
2. F12 누르기
3. Console 탭 선택
4. 로그 확인하면서 테스트
```

### **2단계: 텍스트 선택 (1분)** 🔥
```
1. [제출물 피드백] → 아무 제출물 클릭
2. [선택] 도구 클릭
3. PDF 텍스트 드래그

콘솔 확인:
✅ "텍스트 선택 시작: { clientRects: 3, ... }"
✅ "Rect 0: { left: 120, top: 250, ... }"
✅ "Group 좌표: { left: 120, top: 250 }"
✅ "✅ Added annotation: type=comment, id=anno-..."
✅ "   좌표: { left: 120, top: 250, type: group }"
✅ "   마커 생성 완료"

화면 확인:
✅ 토스트 "텍스트 영역이 선택되었습니다"
✅ 마커(①) 텍스트 좌상단에 즉시 표시
✅ 오류 메시지 없음
```

### **3단계: 영역 지정 (30초)** 🔥
```
1. [영역지정] 도구 클릭
2. 드래그로 영역 지정

콘솔 확인:
✅ "영역 지정 완료: { left: 200, top: 300, ... }"
✅ "✅ Added annotation: type=comment, ..."
✅ "   마커 생성 완료"

화면 확인:
✅ 토스트 "영역이 지정되었습니다"
✅ 마커(②) 즉시 표시
```

### **4단계: 판서 (30초)** 🔥
```
1. [판서] 도구 선택
2. 선 그리기
3. 5페이지로 이동
4. 코멘트 패널에서 [1페이지로 이동] 클릭

콘솔 확인:
✅ "Path 생성: drawing { pathLength: ... }"

화면 확인:
✅ 판서 정상 표시
✅ 다른 페이지에 판서 안 나타남
```

### **5단계: 연결 이동 (1분)** 🔥
```
1. 코멘트 ① [연결] 클릭
2. 코멘트 ⑤ [연결] 클릭
3. ✅ 연결 완료
4. 코멘트 ① 카드에서 "💬 5" 클릭

화면 확인:
✅ 5번 코멘트가 있는 페이지로 이동
✅ 5번 코멘트 하이라이트 (노란색)
✅ 5번 코멘트 카드로 스크롤
```

---

## 🔍 로그 예시

### **정상 작동 시**
```
텍스트 선택 시작: {clientRects: 2, canvasRect: {...}, currentScale: 1}
Rect 0: {left: 150, top: 300, width: 280, height: 16}
Rect 1: {left: 150, top: 316, width: 120, height: 16}
Group 좌표: {left: 150, top: 300}
✅ Added annotation: type=comment, id=anno-1730634567890, page=1
   좌표: {left: 150, top: 300, type: "group"}
🔍 마커 재생성 시작: {page: 1, totalPages: 1}
  Comment 1: {id: "anno-1730634567890", type: "group", left: 150, top: 300}
    Group 좌표: {left: 150, top: 300}
    ✅ Marker 1 생성: {left: 150, top: 300}
✅ 마커 재생성 완료: {total: 1}
   마커 생성 완료
```

### **문제 발생 시**
```
❌ addAnnotation 오류: [에러 메시지]
   스택: [스택 트레이스]

또는

⚠️ left < 0, 보정: -50 → 10
```

---

## 🐛 문제 해결

### **마커가 안 보이면**
```javascript
// Console에 입력
annotations[1]  // 현재 페이지 주석 확인
document.getElementById('marker-container').children  // 마커 DOM 확인
```

### **좌표가 이상하면**
```
로그에서 확인:
"Group 좌표: { left: X, top: Y }"
"Marker N 생성: { left: X, top: Y }"

X, Y가 음수거나 1000 이상이면 버그
```

### **오류 메시지가 나오면**
```
로그에서 확인:
"❌ addAnnotation 오류: ..."
"   스택: ..."

스크린샷 + 로그 전체 복사해서 공유
```

---

## 📊 v3 → v4 변경 사항

| 항목 | v3 | v4 |
|------|----|----|
| **좌표 계산** | `/currentScale` ❌ | 스케일 제거 ✅ |
| **마커 생성** | `setTimeout(50ms)` ❌ | 즉시 생성 ✅ |
| **렌더링** | 누락 ❌ | `renderAll()` 추가 ✅ |
| **에러 처리** | 간단 | 상세 로그 ✅ |
| **연결 이동** | 없음 | 클릭 이동 ✅ |

---

## 🎯 체크리스트

### **필수 테스트**
- [ ] F12 콘솔 열림
- [ ] 텍스트 드래그 → 마커 즉시 표시
- [ ] 콘솔에 "마커 생성 완료" 로그
- [ ] 영역 지정 → 마커 즉시 표시
- [ ] 판서 → 페이지 이동 → 정상 표시
- [ ] 연결 코멘트 번호 클릭 → 이동

### **오류 확인**
- [ ] 오류 메시지 없음
- [ ] 콘솔에 "❌" 없음
- [ ] 마커가 페이지 밖에 안 나감
- [ ] 좌표가 음수 아님

---

## 💬 피드백

**테스트 후 알려주세요:**

1. ✅ 해결됨 / ❌ 여전히 문제
2. 콘솔 로그 캡처
3. 새로운 버그 발견 시 상세 설명

**중요:**
- 반드시 F12 콘솔을 열고 테스트
- 로그를 확인하면서 진행
- 문제 발생 시 콘솔 내용 공유

---

**Version:** 4.4 (v4 Debug)  
**Date:** 2025-11-03  
**Status:** 🧪 디버깅 테스트 중

**모든 로그를 확인하면서 테스트해 주세요!** 🔍
